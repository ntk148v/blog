<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="NOTE(kiennt): There is a legacy Faythe guideline. The new version is coming soon, check its repository for status.
 This guide describes how to automatically scale out your Compute instances in response to heavy system usage. By combining with Prometheus pre-defined rules that consider factors such as CPU or memory usage, you can configure OpenStack Orchestration (Heat) to add and remove additional instances automatically, when they are needed.
1. The standard OpenStack Autoscaling approach #  Let&rsquo;s talk about the standard OpenStack Autoscaling approach before goes to the new approach.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Openstack Autoscaling New Approach">
<meta property="og:description" content="NOTE(kiennt): There is a legacy Faythe guideline. The new version is coming soon, check its repository for status.
 This guide describes how to automatically scale out your Compute instances in response to heavy system usage. By combining with Prometheus pre-defined rules that consider factors such as CPU or memory usage, you can configure OpenStack Orchestration (Heat) to add and remove additional instances automatically, when they are needed.
1. The standard OpenStack Autoscaling approach #  Let&rsquo;s talk about the standard OpenStack Autoscaling approach before goes to the new approach.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ntk148v.github.io/blog/posts/openstack-autoscaling-new-approach/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-08-19T21:19:38+07:00">
<meta property="article:modified_time" content="2021-11-05T15:30:00+07:00"><meta property="og:site_name" content="/home/kiennt">
<title>Openstack Autoscaling New Approach | /home/kiennt</title>
<link rel=manifest href=/blog/manifest.json>
<link rel=icon href=/blog/favicon.png type=image/x-icon>
<link rel=stylesheet href=/blog/book.min.2625e69c6b7661c7675edd24ba686fbc2f7d3dfe3fadbf62681b4d2cf2fead9d.css integrity="sha256-JiXmnGt2YcdnXt0kumhvvC99Pf4/rb9iaBtNLPL+rZ0=" crossorigin=anonymous>
<script defer src=/blog/flexsearch.min.js></script>
<script defer src=/blog/en.search.min.5b28a70dee84eaf6f1acae9c8e95f06a6a17d8a514620c1cc4910e336625e3e1.js integrity="sha256-WyinDe6E6vbxrK6cjpXwamoX2KUUYgwcxJEOM2Yl4+E=" crossorigin=anonymous></script>
<script defer src=/blog/sw.min.f4bc4151631c92d29816d24dfaacb947aa6b03f91ec1c0cd2738ba8957d04791.js integrity="sha256-9LxBUWMcktKYFtJN+qy5R6prA/kewcDNJzi6iVfQR5E=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css type=text/css>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/blog/><span>/home/kiennt</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li><a href=/blog/about/>About</a></li>
<li><a href=/blog/posts/>Posts</a></li>
<li><a href=https://ntk148v.github.io/notes>Notes</a></li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/blog/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Openstack Autoscaling New Approach</strong>
<label for=toc-control>
<img src=/blog/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#1-the-standard-openstack-autoscaling-approach>1. The standard OpenStack Autoscaling approach</a>
<ul>
<li><a href=#11-main-components>1.1. Main components</a></li>
<li><a href=#12-autoscaling-process>1.2. Autoscaling process</a></li>
<li><a href=#13-drawbacks>1.3. Drawbacks</a></li>
</ul>
</li>
<li><a href=#2-the-new-approach-with-faythe>2. The new approach with Faythe</a>
<ul>
<li><a href=#21-the-idea>2.1. The idea</a></li>
<li><a href=#22-the-implementation>2.2. The implementation</a></li>
<li><a href=#23-guideline>2.3. Guideline</a></li>
<li><a href=#24-drawbacks-and-todo>2.4. Drawbacks and TODO</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1>
<a href=/blog/posts/openstack-autoscaling-new-approach/>Openstack Autoscaling New Approach</a>
</h1>
<h5>Aug 19, 2019</h5>
<div>
<a href=/blog/tags/openstack/>#openstack</a>
<a href=/blog/tags/prometheus/>#prometheus</a>
<a href=/blog/tags/faythe/>#faythe</a>
<a href=/blog/tags/tech/>#tech</a>
</div>
<blockquote>
<p>NOTE(kiennt): There is a <a href=https://github.com/vCloud-DFTBA/faythe/blob/legacy/docs/autoscaling.md>legacy Faythe guideline</a>. The new version is coming soon, check <a href=https://github.com/vCloud-DFTBA/faythe>its repository</a> for status.</p>
</blockquote>
<p>This guide describes how to automatically scale out your Compute instances in response to heavy system usage. By combining with Prometheus pre-defined rules that consider factors such as CPU or memory usage, you can configure OpenStack Orchestration (Heat) to add and remove additional instances automatically, when they are needed.</p>
<h2 id=1-the-standard-openstack-autoscaling-approach>
1. The standard OpenStack Autoscaling approach
<a class=anchor href=#1-the-standard-openstack-autoscaling-approach>#</a>
</h2>
<p>Let&rsquo;s talk about the standard OpenStack Autoscaling approach before goes to the new approach.</p>
<h3 id=11-main-components>
1.1. Main components
<a class=anchor href=#11-main-components>#</a>
</h3>
<ul>
<li>
<p>Orchestration: The core component providing automatic scaling is Orchestration (heat). Orchestration allows you to define rules using human-readable YAML templates. These rules are applied to evaluate system load based on Telemetry data to find out whether there is need to more instances into the stack. Once the load has dropped, Orchestration can automatically remove the unused instances again.</p>
</li>
<li>
<p>Telemetry: Telemetry does performance monitoring of your OpenStack environment, collecting data on CPU, storage and memory utilization for instances and physical hosts. Orchestration templates examine Telemetry data to access whether any pre-defined action should start.</p>
<ul>
<li>Ceilometer: a data collection service that provides the ability to normalise and transform data across all current OpenStack core components with work underway to support future OpenStack components.</li>
<li>Gnocchi: provides a time-series resource indexing, metric storage service with enables users to capture OpenStack resources and the metrics associated with them.</li>
<li>Aodh: enables the abiltity to trigger actions based on defined rules against sample or event data collected by Ceilometer.</li>
</ul>
</li>
</ul>
<h3 id=12-autoscaling-process>
1.2. Autoscaling process
<a class=anchor href=#12-autoscaling-process>#</a>
</h3>
<p>For more details, you could check <a href=https://ibm-blue-box-help.github.io/help-documentation/heat/autoscaling-with-heat/>IBM help documentation</a></p>
<h3 id=13-drawbacks>
1.3. Drawbacks
<a class=anchor href=#13-drawbacks>#</a>
</h3>
<ul>
<li>Ceilometer, Aodh are lacking of contribution. Ceilometer API was <a href=https://review.opendev.org/#/c/512286/>deprecated</a>. Either Transform and pipeline was <a href=https://review.opendev.org/#/c/560854/>the same state</a>, it means cpu_util will be unusable soon. In the commit message, @sileht - Ceilometer Core reviewer wrote that &ldquo;Also backend like Gnocchi offers a better alternative to compute them&rdquo;. But Aodh still <a href=https://github.com/openstack/aodh/blob/master/aodh/evaluator/gnocchi.py#L140>deprecated Gnocchi aggregation API</a> which doesn&rsquo;t support <code>rate:mean</code>. For more details, you can follow the <a href=https://github.com/gnocchixyz/gnocchi/issues/999>issue I&rsquo;ve opened before</a>. Be honest, I was gave up on it - 3 projects which was tightly related together, one change might cause a sequence and break the whole stack, how can I handle that?</li>
<li>Aodh has its own formula to define rule based on Ceilometer metrics (that were stored in Gnocchi). But it isn&rsquo;t correct sometimes cause the wrong scaling action.</li>
<li>In reality, I face the case that Rabbitmq was under heavy load due to Ceilometer workload.</li>
<li>IMO, Gnocchi documentation is not good enough. It might be a bias personal opinion.</li>
</ul>
<h2 id=2-the-new-approach-with-faythe>
2. The new approach with Faythe
<a class=anchor href=#2-the-new-approach-with-faythe>#</a>
</h2>
<h3 id=21-the-idea>
2.1. The idea
<a class=anchor href=#21-the-idea>#</a>
</h3>
<p>Actually, this isn&rsquo;t a complete new approach, it still leverages Orchestration (heat) to do scaling action. The different comes from Monitor service.</p>
<p>Take a look at <a href=https://www.slideshare.net/GuanYuLin1/autoscale-a-selfhealing-cluster-in-openstack-with-heat>Rico Lin - Heat&rsquo;s PTL, autoscale slide</a>, basically, Autoscaling is the combination of 3 steps:</p>
<ul>
<li>Metering.</li>
<li>Alarm.</li>
<li>Scale.</li>
</ul>
<p><img src="https://image.slidesharecdn.com/auto-scaleaself-healingclusterinopenstack1-180824033106/95/autoscale-a-selfhealing-cluster-in-openstack-with-heat-21-638.jpg?cb=1536873751" alt></p>
<p>OpenStack Telemetry takes care of <code>Metering</code> and <code>Alarm</code>. Ok, the new approach is simply using <em>another service that can take Telemetry roles</em>.</p>
<p>The <em>another service</em> is <a href=https://prometheus.io/>Prometheus stack</a>. The question here is why I chose this?</p>
<ul>
<li>Nice query language: Prometheus provides a functional query language called PromQL (Prometheus Query Language) that lets the user select and aggregate time series data in real time.</li>
<li>A wide range of exporter: The more exporter the more metrics I can collect and evaluate.</li>
<li>Flexibile: Beside the system factor like CPU/Memory usage, I can evaluate any metrics I can collect, for example: JVM metrics.</li>
<li>// Take time to investigate about Prometheus and fill it here by yourself</li>
</ul>
<h3 id=22-the-implementation>
2.2. The implementation
<a class=anchor href=#22-the-implementation>#</a>
</h3>
<p><strong>The ideal architecture</strong></p>
<pre>
                                               +--------------------------------------------------+
                                               |                                                  |
                                               |     +-----------------+  +-----------------+     |
+---------------------+                        |     |   Instance 1    |  |   Instance 2    |     |
|                     |                        |     |                 |  |                 |     |
|                     |            Scrape Metrics    |  +-----------+  |  |  +-----------+  |     |
|  Prometheus server  <------------------------+--------+Exporter(s)|  |  |  |Exporter(s)|  |     |
|                     |                        |     |  +-----------+  |  |  +-----------+  |     |
|                     |                        |     +-----------------+  +-----------------+     |
+----------+----------+                        |     +--------------------------------------+     |
           |                                   |     |           Autoscaling Group          |     |
           | Fire alerts                       |     +--------------------------------------+     |
           |                                   |                                                  |
           |                                   |                                                  |
+----------v------------+                      |     +--------------------------------------+     |
|                       |         Send scale request |                                      |     |
|Prometheus Alertmanager+----------------------+----->          Scaling Policy              |     |
|                       |                      |     |                                      |     |
+-----------------------+                      |     +--------------------------------------+     |
                                               |                                                  |
                                               |                     Heat Stack                   |
                                               +--------------------------------------------------+
</pre>
<ul>
<li>Prometheus server scrapes metrics from exporters that launch inside Instance.</li>
<li>Prometheus server evaluates metrics with pre-defined rules.</li>
<li>Prometheus server fires alert to Prometheus alertmanager.</li>
<li>Prometheus alertmanager sends POST Scale request to Heat Scaling policy with webhook configuration.</li>
</ul>
<p>It&rsquo;s a piece of cake, right? But <em>where is Faythe, I don&rsquo;t see it?</em> Let&rsquo;s talk about the solution problems:</p>
<ul>
<li>Prometheus Alertmanager webhook config doesn&rsquo;t <a href=https://github.com/prometheus/common/issues/140>support additional HTTP headers</a>. And they won&rsquo;t! ðŸ˜¢ Heat Scaling Policy signal url requires <code>X-Auth-Token</code> in header and Prometheus can&rsquo;t generate a token itself, either.</li>
<li>Heat doesn&rsquo;t recognize the resolved alerts from Prometheus Alertmanager to execute scale in action.</li>
<li>How to connect these components together?</li>
</ul>
<p>We need a 3rd service to solve these problems - <code>Faythe does some magic</code>.</p>
<center><iframe src=https://giphy.com/embed/12NUbkX6p4xOO4 width=480 height=440 frameborder=0 class=giphy-embed allowfullscreen></iframe><p><a href=https://giphy.com/gifs/shia-labeouf-12NUbkX6p4xOO4>via GIPHY</a></p></center>
<p><strong>The reality architecture</strong></p>
<pre>
                                              ++-------------------------------------------------+
                                               |                                                  +
                                               |     +-----------------+  +-----------------+     |
+---------------------+                        |     |   Instance 1    |  |   Instance 2    |     |
|                     |                        +     |                 |  |                 |     |
|                     |            Scrape Metrics    |  +-----------+  |  |  +-----------+  |     |
|  Prometheus server  <------------------------+--------+Exporter(s)|  |  |  |Exporter(s)|  |     |
|                     |                        |     |  +-----------+  |  |  +-----------+  |     |
|                     |                        |     +-----------------+  +-----------------+     |
+----------+----------+                        |     +--------------------------------------+     |
           |                                   |     |           Autoscaling Group          |     |
           | Fire alerts                       |     +--------------------------------------+     |
           |                                   |                                                  |
           |                                   |                                                  |
+----------v------------+                      |     +--------------------------------------+     |
|                       |                      |     |                                      |     |
|Prometheus Alertmanager|                      |                Scaling Policy              |     |
|                       |                      |     |                                      |     |
+-----------+-----------+                      |     +-----^--------------------------------+     |
            |                                  |           |                                      |
            | Send request through             |           |         Heat Stack                   |
            | pre-configured webhook           +--------------------------------------------------+
            |                                              |
+-----------v-----------+                                  |
|                       |                                  |
|        Faythe         +----------------------------------+
|                       |       Send actual scale request
+-----------------------+

</pre>
<blockquote>
<p>NOTE: The stack leverages OpenStack instance metadata and Prometheus labels.</p>
</blockquote>
<ul>
<li>Prometheus server scrapes metrics from exporters that launch inside Instance.</li>
<li>Prometheus server evaluates metrics with pre-defined rules.</li>
<li>Prometheus server fires alert to Prometheus alertmanager.</li>
<li>Prometheus alertmanager sends Alerts via pre-configured webhook URL - Faythe endpoint.</li>
<li>Faythe receives and processes Alerts (dedup, group alert and generate a Heat signal URL) and creates a POST request to scale endpoint.</li>
</ul>
<h3 id=23-guideline>
2.3. Guideline
<a class=anchor href=#23-guideline>#</a>
</h3>
<p>The current aprroach requires some further setup and configuration from Prometheus and Heat stack. You will see that it&rsquo;s quite complicated.</p>
<p><strong>The simplify in logic is paid by the complex config steps.</strong></p>
<p><strong>Step 1:</strong> Create a stack - the following is the sample template. It has several requirements:</p>
<ul>
<li>OS::Heat::ScalingPolicy has to be named as <code>scaleout_policy</code> and <code>scalein_policy</code>.</li>
<li>OS::Heat::AutoScalingGroup&rsquo;s instance metadata has to contain <code>stack_asg_name</code> and <code>stack_asg_id</code>. It will be used to generate signal URL.</li>
<li>Instance should have a cloud init script to enable and start Prometheus exporters automatically.</li>
</ul>
<div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#111>---</span>
<span style=color:#f92672>resources</span><span style=color:#111>:</span>
  <span style=color:#f92672>asg</span><span style=color:#111>:</span>
    <span style=color:#f92672>type</span><span style=color:#111>:</span> <span style=color:#ae81ff>OS::Heat::AutoScalingGroup</span>
    <span style=color:#f92672>properties</span><span style=color:#111>:</span>
      <span style=color:#f92672>min_size</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>min_size }</span>
      <span style=color:#f92672>max_size</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>max_size }</span>
      <span style=color:#f92672>resource</span><span style=color:#111>:</span>
        <span style=color:#f92672>type</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>service_template }</span>
        <span style=color:#f92672>properties</span><span style=color:#111>:</span>
          <span style=color:#f92672>flavor</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>flavor }</span>
          <span style=color:#f92672>image</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>image }</span>
          <span style=color:#f92672>key_name</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>key_name }</span>
          <span style=color:#f92672>network</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>network }</span>
          <span style=color:#f92672>subnet</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>subnet }</span>
          <span style=color:#f92672>metadata</span><span style=color:#111>:</span> {
              <span style=color:#f92672>&#34;monitoring&#34;: </span><span style=color:#d88200>&#34;1&#34;</span><span style=color:#111>,</span> <span style=color:#75715e>## Required</span>
              <span style=color:#f92672>&#34;service&#34;: </span><span style=color:#d88200>&#34;myservice&#34;</span><span style=color:#111>,</span>
              <span style=color:#f92672>&#34;stack_asg_name&#34;: </span>{ <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;OS::stack_name&#34;</span> }<span style=color:#111>,</span> <span style=color:#75715e>## Required</span>
              <span style=color:#f92672>&#34;stack_asg_id&#34;: </span>{ <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;OS::stack_id&#34;</span> }<span style=color:#111>,</span> <span style=color:#75715e>## Required</span>
            }
          <span style=color:#f92672>security_group</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>security_group }</span>

  <span style=color:#f92672>scaleout_policy</span><span style=color:#111>:</span> <span style=color:#75715e>## Have to be named as `scaleout_policy`</span>
    <span style=color:#f92672>type</span><span style=color:#111>:</span> <span style=color:#ae81ff>OS::Heat::ScalingPolicy</span>
    <span style=color:#f92672>properties</span><span style=color:#111>:</span>
      <span style=color:#f92672>adjustment_type</span><span style=color:#111>:</span> <span style=color:#ae81ff>change_in_capacity</span>
      <span style=color:#f92672>auto_scaling_group_id</span><span style=color:#111>:</span> { <span style=color:#f92672>get_resource</span><span style=color:#111>:</span> <span style=color:#ae81ff>asg }</span>
      <span style=color:#f92672>cooldown</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>scale_out_cooldown }</span>
      <span style=color:#f92672>scaling_adjustment</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>scaling_out_adjustment }</span>

  <span style=color:#f92672>scalein_policy</span><span style=color:#111>:</span> <span style=color:#75715e>## Have to be named as `scalein_policy`</span>
    <span style=color:#f92672>type</span><span style=color:#111>:</span> <span style=color:#ae81ff>OS::Heat::ScalingPolicy</span>
    <span style=color:#f92672>properties</span><span style=color:#111>:</span>
      <span style=color:#f92672>adjustment_type</span><span style=color:#111>:</span> <span style=color:#ae81ff>change_in_capacity</span>
      <span style=color:#f92672>auto_scaling_group_id</span><span style=color:#111>:</span> { <span style=color:#f92672>get_resource</span><span style=color:#111>:</span> <span style=color:#ae81ff>asg }</span>
      <span style=color:#f92672>cooldown</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>scale_in_cooldown }</span>
      <span style=color:#f92672>scaling_adjustment</span><span style=color:#111>:</span> { <span style=color:#f92672>get_param</span><span style=color:#111>:</span> <span style=color:#ae81ff>scaling_in_adjustment }</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 2:</strong> Configure Prometheus openstack discovery</p>
<div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>job_name</span><span style=color:#111>:</span> <span style=color:#ae81ff>openstack_scale_test</span>
  <span style=color:#f92672>openstack_sd_configs</span><span style=color:#111>:</span>
    - <span style=color:#f92672>role</span><span style=color:#111>:</span> <span style=color:#ae81ff>instance</span>
      <span style=color:#f92672>identity_endpoint</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackendpoint&gt;&#34;</span>
      <span style=color:#f92672>username</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackusername&gt;&#34;</span>
      <span style=color:#f92672>password</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackpassword&gt;&#34;</span>
      <span style=color:#f92672>domain_name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;default&#34;</span>
      <span style=color:#f92672>port</span><span style=color:#111>:</span> <span style=color:#ae81ff>9100</span> <span style=color:#75715e>## Exporter endpoint</span>
      <span style=color:#f92672>refresh_interval</span><span style=color:#111>:</span> <span style=color:#ae81ff>20s</span>
      <span style=color:#f92672>region</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;RegionOne&#34;</span>
      <span style=color:#f92672>project_name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackproject&gt;&#34;</span>

  <span style=color:#f92672>relabel_configs</span><span style=color:#111>:</span>
    <span style=color:#75715e>## Only keep metrics from ACTIVE instance</span>
    - <span style=color:#f92672>source_labels</span><span style=color:#111>:</span> <span style=color:#111>[</span><span style=color:#ae81ff>__meta_openstack_instance_status]</span>
      <span style=color:#f92672>action</span><span style=color:#111>:</span> <span style=color:#ae81ff>keep</span>
      <span style=color:#f92672>regex</span><span style=color:#111>:</span> <span style=color:#ae81ff>ACTIVE</span>

    <span style=color:#75715e>## Only scrape from instance with monitoring tag</span>
    - <span style=color:#f92672>source_labels</span><span style=color:#111>:</span> <span style=color:#111>[</span><span style=color:#ae81ff>__meta_openstack_tag_monitoring]</span>
      <span style=color:#f92672>action</span><span style=color:#111>:</span> <span style=color:#ae81ff>keep</span>
      <span style=color:#f92672>regex</span><span style=color:#111>:</span> <span style=color:#ae81ff>1</span>

    - <span style=color:#f92672>source_labels</span><span style=color:#111>:</span> <span style=color:#111>[</span><span style=color:#ae81ff>__meta_openstack_project_id]</span>
      <span style=color:#f92672>target_label</span><span style=color:#111>:</span> <span style=color:#ae81ff>project_id</span>
      <span style=color:#f92672>replacement</span><span style=color:#111>:</span> <span style=color:#ae81ff>$1</span>

    - <span style=color:#f92672>source_labels</span><span style=color:#111>:</span> <span style=color:#111>[</span><span style=color:#ae81ff>__meta_openstack_tag_stack_asg_name]</span>
      <span style=color:#f92672>target_label</span><span style=color:#111>:</span> <span style=color:#ae81ff>stack_asg_name</span>
      <span style=color:#f92672>replacement</span><span style=color:#111>:</span> <span style=color:#ae81ff>$1</span>

    - <span style=color:#f92672>source_labels</span><span style=color:#111>:</span> <span style=color:#111>[</span><span style=color:#ae81ff>__meta_openstack_tag_stack_asg_id]</span>
      <span style=color:#f92672>target_label</span><span style=color:#111>:</span> <span style=color:#ae81ff>stack_asg_id</span>
      <span style=color:#f92672>replacement</span><span style=color:#111>:</span> <span style=color:#ae81ff>$1</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 3:</strong> Define a Prometheus rule, for example:</p>
<div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>groups</span><span style=color:#111>:</span>
  - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#ae81ff>targets</span>
    <span style=color:#f92672>rules</span><span style=color:#111>:</span>
      - <span style=color:#f92672>alert</span><span style=color:#111>:</span> <span style=color:#ae81ff>high_memory_load</span>
        <span style=color:#f92672>expr</span><span style=color:#111>:</span> <span style=color:#ae81ff>avg by(stack_asg_id, stack_asg_name, project_id) ((node_memory_MemTotal_bytes{service=&#34;myservice&#34;} - node_memory_MemFree_bytes{service=&#34;myservice&#34;}) / node_memory_MemTotal_bytes{service=&#34;myservice&#34;} * 100) &gt; 80</span>
        <span style=color:#f92672>for</span><span style=color:#111>:</span> <span style=color:#ae81ff>5m</span>
        <span style=color:#f92672>labels</span><span style=color:#111>:</span>
          <span style=color:#f92672>severity</span><span style=color:#111>:</span> <span style=color:#ae81ff>critical</span>
        <span style=color:#f92672>annotations</span><span style=color:#111>:</span>
          <span style=color:#f92672>summary</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;High memory&#34;</span>
          <span style=color:#f92672>description</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;Instance {{ $labels.instance }} of job {{ $labels.job }} (stack {{ $labels.stack_id }} has been high af for 5m&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 4:</strong> Configure Prometheus Alertmanager webhook, for example:</p>
<div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>route</span><span style=color:#111>:</span>
  <span style=color:#f92672>receiver</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;custom_alert&#34;</span>
  <span style=color:#f92672>group_wait</span><span style=color:#111>:</span> <span style=color:#ae81ff>20s</span>
  <span style=color:#f92672>group_interval</span><span style=color:#111>:</span> <span style=color:#ae81ff>3m</span>

<span style=color:#f92672>receivers</span><span style=color:#111>:</span>
  - <span style=color:#f92672>name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;custom_alert&#34;</span>
    <span style=color:#f92672>webhook_configs</span><span style=color:#111>:</span>
      - <span style=color:#f92672>send_resolved</span><span style=color:#111>:</span> <span style=color:#00a8c8>true</span>
        <span style=color:#f92672>url</span><span style=color:#111>:</span> <span style=color:#ae81ff>http://&lt;faythe-host&gt;:&lt;faythe-port&gt;/openstack/autoscaling/openstack-1f</span>
        <span style=color:#f92672>http_config</span><span style=color:#111>:</span>
          <span style=color:#f92672>basic_auth</span><span style=color:#111>:</span>
            <span style=color:#f92672>username</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;admin&#34;</span>
            <span style=color:#f92672>password</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;password&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Note that, <code>openstack-1f</code> has to be the name of OpenStack configuration group in Faythe config file. It helps Faythe to work with multiple OpenStack.</p>
<p><strong>Step 5:</strong> Configure Faythe</p>
<div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e>## OpenStackConfiguration.</span>
<span style=color:#f92672>openstack_configs</span><span style=color:#111>:</span>
  <span style=color:#f92672>openstack-1f</span><span style=color:#111>:</span>
    <span style=color:#f92672>region_name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;RegionOne&#34;</span>
    <span style=color:#f92672>domain_name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;Default&#34;</span>
    <span style=color:#f92672>auth_url</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackendpoint&gt;&#34;</span>
    <span style=color:#f92672>username</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackusername&gt;&#34;</span>
    <span style=color:#f92672>password</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackpassword&gt;&#34;</span>
    <span style=color:#f92672>project_name</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;&lt;openstackproject&gt;&#34;</span>

<span style=color:#f92672>server_config</span><span style=color:#111>:</span>
  <span style=color:#75715e>## Example:</span>
  <span style=color:#75715e>## &#34;www.example.com&#34;</span>
  <span style=color:#75715e>## &#34;([a-z]+).domain.com&#34;</span>
  <span style=color:#75715e>## remote_host_pattern: &#34;10.240.202.209.*&#34;</span>
  <span style=color:#f92672>basic_auth</span><span style=color:#111>:</span>
    <span style=color:#f92672>username</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;admin&#34;</span>
    <span style=color:#f92672>password</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;password&#34;</span>
  <span style=color:#f92672>log_dir</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;/whatever/directory/faythe-logs&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 6:</strong> Let&rsquo;s make them work:</p>
<ul>
<li>Prometheus server.</li>
<li>Prometheus alertmanager.</li>
<li>Faythe.</li>
</ul>
<center><iframe src=https://giphy.com/embed/cLlVn5zC5UOSmQZKJ7 width=480 height=270 frameborder=0 class=giphy-embed allowfullscreen></iframe><p><a href=https://giphy.com/gifs/RobertEBlackmon-bye-go-away-anna-wintour-cLlVn5zC5UOSmQZKJ7>via GIPHY</a></p></center>
<h3 id=24-drawbacks-and-todo>
2.4. Drawbacks and TODO
<a class=anchor href=#24-drawbacks-and-todo>#</a>
</h3>
<p><strong>Drawbacks</strong></p>
<ul>
<li>The configuration steps is way too complicated, many manual steps have to be done.</li>
</ul>
<p><strong>TODO</strong></p>
<ul>
<li>Simplify strategy, might need a service discovery.</li>
</ul>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/ntk148v/blog/commit/4a2cdf393549afb9851b13a15c09d0fe8c54e6c4 title="Last modified by Kien Nguyen | Nov 05, 2021" target=_blank rel=noopener>
<img src=/blog/svg/calendar.svg class=book-icon alt=Calendar>
<span>Nov 05, 2021</span>
</a>
</div>
<div>
<a class="flex align-center" href=https://github.com/ntk148v/blog/edit/master/content/posts/openstack-autoscaling-new-approach.md target=_blank rel=noopener>
<img src=/blog/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments><section class="article discussion">
<script src=https://utteranc.es/client.js repo=ntk148v/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</section></div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#1-the-standard-openstack-autoscaling-approach>1. The standard OpenStack Autoscaling approach</a>
<ul>
<li><a href=#11-main-components>1.1. Main components</a></li>
<li><a href=#12-autoscaling-process>1.2. Autoscaling process</a></li>
<li><a href=#13-drawbacks>1.3. Drawbacks</a></li>
</ul>
</li>
<li><a href=#2-the-new-approach-with-faythe>2. The new approach with Faythe</a>
<ul>
<li><a href=#21-the-idea>2.1. The idea</a></li>
<li><a href=#22-the-implementation>2.2. The implementation</a></li>
<li><a href=#23-guideline>2.3. Guideline</a></li>
<li><a href=#24-drawbacks-and-todo>2.4. Drawbacks and TODO</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>