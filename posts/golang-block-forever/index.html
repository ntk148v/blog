<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sometimes, you want to block the current goroutine when allowing others to continue. Here is some tricks I&rsquo;ve collected:
1. References # Firstly give them some credits:
https://blog.sgmansfield.com/2016/06/how-to-block-forever-in-go/ https://pliutau.com/different-ways-to-block-go-runtime-forever/ NOTE: I run these with Golang 1.12
2. The original # 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import &#34;fmt&#34; func show() { for i := 1; i < 9696969; i++ { time."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Golang: Block forever"><meta property="og:description" content="Sometimes, you want to block the current goroutine when allowing others to continue. Here is some tricks I&rsquo;ve collected:
1. References # Firstly give them some credits:
https://blog.sgmansfield.com/2016/06/how-to-block-forever-in-go/ https://pliutau.com/different-ways-to-block-go-runtime-forever/ NOTE: I run these with Golang 1.12
2. The original # 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import &#34;fmt&#34; func show() { for i := 1; i < 9696969; i++ { time."><meta property="og:type" content="article"><meta property="og:url" content="https://ntk148v.github.io/blog/posts/golang-block-forever/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-27T15:59:21+07:00"><meta property="article:modified_time" content="2020-04-28T15:18:38+07:00"><meta property="og:site_name" content="/home/kiennt"><title>Golang: Block forever | /home/kiennt</title><link rel=manifest href=/blog/manifest.json><link rel=icon href=/blog/favicon.png type=image/x-icon><link rel=stylesheet href=/blog/book.min.0afd0f4d0300240b9f0a5e95c3b39076c805a1ef4c94cdba8bd3ddf881d315b5.css integrity="sha256-Cv0PTQMAJAufCl6Vw7OQdsgFoe9MlM26i9Pd+IHTFbU=" crossorigin=anonymous><script defer src=/blog/flexsearch.min.js></script>
<script defer src=/blog/en.search.min.0cdfafef0afd6d8d70cd0c9e4a97270c6d244a5e5202097712a69ccea8e4add5.js integrity="sha256-DN+v7wr9bY1wzQyeSpcnDG0kSl5SAgl3EqaczqjkrdU=" crossorigin=anonymous></script>
<script defer src=/blog/sw.min.e30dcfc647efc866455c67b26b2aabda17816f06fe2dd202ac21b4422180bd9b.js integrity="sha256-4w3PxkfvyGZFXGeyayqr2heBbwb+LdICrCG0QiGAvZs=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css type=text/css><script async defer src=https://buttons.github.io/buttons.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h3 class=terminal-logo><div class="logo terminal-prompt"><a href=/blog/ class="no-style site-name"><strong>/home/kiennt</strong></a>:~#</div></h3><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/blog/about/>./about/</a></li><li><a href=/blog/posts/>./posts/</a></li><li><a href=https://ntk148v.github.io/notes target=_blank rel=noopener>./notes/</a></li><li><a href=https://ntk148v.github.io/mammam target=_blank rel=noopener>./mammam/</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/blog/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Golang: Block forever</strong>
<label for=toc-control><img src=/blog/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#1-references>1. References</a></li><li><a href=#2-the-original>2. The original</a></li><li><a href=#3-bad---an-empty-infinite-loop>3. Bad - An empty infinite loop</a></li><li><a href=#4-good---busy-blocking>4. Good - Busy blocking</a></li><li><a href=#5-good---waiting-on-itself>5. Good - Waiting on itself</a></li><li><a href=#6-good---empty-select>6. Good - Empty select</a></li><li><a href=#7-good---double-locking>7. Good - Double locking</a></li><li><a href=#8-good---reading-an-empty-channel>8. Good - Reading an Empty Channel</a></li><li><a href=#9-good---self-produce-and-consume>9. Good - Self produce-and-consume</a></li></ul></nav></aside></header><article class=markdown><h1><a href=/blog/posts/golang-block-forever/>Golang: Block forever</a></h1><h5>Apr 27, 2020</h5><div><a href=/blog/tags/golang/>#golang</a>
<a href=/blog/tags/trick/>#trick</a>
<a href=/blog/tags/note/>#note</a></div><p>Sometimes, you want to block the current goroutine when allowing others to continue. Here is some tricks I&rsquo;ve collected:</p><h2 id=1-references>1. References
<a class=anchor href=#1-references>#</a></h2><p>Firstly give them some credits:</p><ol><li><a href=https://blog.sgmansfield.com/2016/06/how-to-block-forever-in-go/>https://blog.sgmansfield.com/2016/06/how-to-block-forever-in-go/</a></li><li><a href=https://pliutau.com/different-ways-to-block-go-runtime-forever/>https://pliutau.com/different-ways-to-block-go-runtime-forever/</a></li></ol><blockquote><p>NOTE: I run these with Golang 1.12</p></blockquote><h2 id=2-the-original>2. The original
<a class=anchor href=#2-the-original>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>1000</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>() <span style=color:#177500>// The main goroutine is exited before the show() be done.
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=3-bad---an-empty-infinite-loop>3. Bad - An empty infinite loop
<a class=anchor href=#3-bad---an-empty-infinite-loop>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#177500>// Empty, just do nothing
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>An infinite loop here is a busy loop that does nothing except burn CPU time.</p><h2 id=4-good---busy-blocking>4. Good - Busy blocking
<a class=anchor href=#4-good---busy-blocking>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;runtime&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>runtime</span>.<span style=color:#000>Gosched</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>It will reduce your CPU usage but it isn&rsquo;t the preferable solution.</p><h2 id=5-good---waiting-on-itself>5. Good - Waiting on itself
<a class=anchor href=#5-good---waiting-on-itself>#</a></h2><p>We wait but we never done XD</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>wg</span> <span style=color:#000>:=</span> <span style=color:#000>sync</span>.<span style=color:#000>WaitGroup</span>{}
</span></span><span style=display:flex><span>    <span style=color:#000>wg</span>.<span style=color:#000>Add</span>(<span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#000>wg</span>.<span style=color:#000>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=6-good---empty-select>6. Good - Empty select
<a class=anchor href=#6-good---empty-select>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>select</span>{ }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=7-good---double-locking>7. Good - Double locking
<a class=anchor href=#7-good---double-locking>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>m</span> <span style=color:#000>:=</span> <span style=color:#000>sync</span>.<span style=color:#000>Mutex</span>{} <span style=color:#177500>// Same with sync.RWMutex
</span></span></span><span style=display:flex><span><span style=color:#177500></span>    <span style=color:#000>m</span>.<span style=color:#000>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>m</span>.<span style=color:#000>Lock</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=8-good---reading-an-empty-channel>8. Good - Reading an Empty Channel
<a class=anchor href=#8-good---reading-an-empty-channel>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{})
</span></span><span style=display:flex><span>    <span style=color:#000>&lt;-</span><span style=color:#000>c</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=9-good---self-produce-and-consume>9. Good - Self produce-and-consume
<a class=anchor href=#9-good---self-produce-and-consume>#</a></h2><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a90d91>package</span> <span style=color:#000>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c41a16>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>forever</span>() {
</span></span><span style=display:flex><span>    <span style=color:#000>c</span> <span style=color:#000>:=</span> <span style=color:#a90d91>make</span>(<span style=color:#a90d91>chan</span> <span style=color:#a90d91>struct</span>{}, <span style=color:#1c01ce>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#a90d91>case</span> <span style=color:#000>&lt;-</span><span style=color:#000>c</span>:
</span></span><span style=display:flex><span>        <span style=color:#a90d91>case</span> <span style=color:#000>c</span> <span style=color:#000>&lt;-</span> <span style=color:#a90d91>struct</span>{}{}:
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>show</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>for</span> <span style=color:#000>i</span> <span style=color:#000>:=</span> <span style=color:#1c01ce>1</span>; <span style=color:#000>i</span> &lt; <span style=color:#1c01ce>9696969</span>; <span style=color:#000>i</span><span style=color:#000>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#000>time</span>.<span style=color:#000>Sleep</span>(<span style=color:#1c01ce>5</span> <span style=color:#000>*</span> <span style=color:#000>time</span>.<span style=color:#000>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#000>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a90d91>func</span> <span style=color:#000>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a90d91>go</span> <span style=color:#000>show</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>forever</span>()
</span></span><span style=display:flex><span>    <span style=color:#000>fmt</span>.<span style=color:#000>Println</span>(<span style=color:#c41a16>&#34;OK we&#39;re done&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/ntk148v/blog/commit/c5f6f38139a5ed65208fc4ecdde8eb810a6a2ecc title='Last modified by Kien Nguyen | Apr 28, 2020' target=_blank rel=noopener><img src=/blog/svg/calendar.svg class=book-icon alt=Calendar>
<span>Apr 28, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/ntk148v/blog/edit/master/content/posts/golang-block-forever.md target=_blank rel=noopener><img src=/blog/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><section class="article discussion"><script src=https://utteranc.es/client.js repo=ntk148v/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></section></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#1-references>1. References</a></li><li><a href=#2-the-original>2. The original</a></li><li><a href=#3-bad---an-empty-infinite-loop>3. Bad - An empty infinite loop</a></li><li><a href=#4-good---busy-blocking>4. Good - Busy blocking</a></li><li><a href=#5-good---waiting-on-itself>5. Good - Waiting on itself</a></li><li><a href=#6-good---empty-select>6. Good - Empty select</a></li><li><a href=#7-good---double-locking>7. Good - Double locking</a></li><li><a href=#8-good---reading-an-empty-channel>8. Good - Reading an Empty Channel</a></li><li><a href=#9-good---self-produce-and-consume>9. Good - Self produce-and-consume</a></li></ul></nav></div></aside></main></body></html>