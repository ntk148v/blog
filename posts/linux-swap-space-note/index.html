<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.70.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Swap space note&nbsp;&ndash;&nbsp;/home/kiennt</title><link rel="stylesheet" href="/blog/css/core.min.27af14d16b5fc0cf9480014502d328096f1596c3f1779bcb37c99b3773ca4069c2972d56bc288df63406f6457b7d4f47.css" integrity="sha384-J68U0WtfwM&#43;UgAFFAtMoCW8VlsPxd5vLN8mbN3PKQGnCly1WvCiN9jQG9kV7fU9H"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Swap space note" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/blog/"><span class="site name">/home/kiennt</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/blog/tags/">Tags</a><a class="nav item" href="/blog/gallery">Gallery</a><a class="nav item" href="/blog/index%2exml">RSS</a></nav></div></span></div><div class="site slogan"><span class="title">Kiennt's ramblings</span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Swap space note</h1><p class="article date">2020-05-20<span class="reading-time"> â€¢ 3 minutes to read</span></p></section><article class="article markdown-body">
        <aside><nav id="TableOfContents">
  <ul>
    <li><a href="#1-what-is-swap">1. What is Swap?</a></li>
    <li><a href="#2-swap-partition-size">2. Swap partition size</a>
      <ul>
        <li><a href="#21-old-rule-of-thumb">2.1. Old rule of thumb</a></li>
        <li><a href="#22-what-is-the-right-amount-of-swap-space">2.2. What is the right amount of swap space?</a></li>
      </ul>
    </li>
    <li><a href="#3-common-misconceptions--gotchas">3. Common misconceptions &amp; gotchas</a>
      <ul>
        <li><a href="#31-increasing-swap-size-would-increase-performance">3.1. Increasing swap size would increase performance</a></li>
        <li><a href="#32-swappiness">3.2. Swappiness</a></li>
        <li><a href="#33-using-swap-as-emergency-memory">3.3. Using swap as emergency memory</a></li>
      </ul>
    </li>
    <li><a href="#4-references">4. References</a></li>
  </ul>
</nav></aside><h2 id="1-what-is-swap">1. What is Swap?</h2>
<p>Swap file systems support virtual memory, data is written to a swap file system when there is not enough RAM to store the data your system is processing.</p>
<h2 id="2-swap-partition-size">2. Swap partition size</h2>
<h3 id="21-old-rule-of-thumb">2.1. Old rule of thumb</h3>
<pre><code>swap = 2 * the-amount-of-RAM
</code></pre><p>So if a computer had 64KB of RAM, a swap partition of 128KB would be an optimum size. This rule took into the facts that RAM sizes were typically quite small at the time. Nowadays, RAM has become a <code>cheap</code> &amp; <code>affordable</code> commondity, so the 2x rule is outdated.</p>
<h3 id="22-what-is-the-right-amount-of-swap-space">2.2. What is the right amount of swap space?</h3>
<p>Choosing the correct swap size is important. Too much swap space can hide memory leaks, also the storage space is allocated but idle. It can affect the system performance in general.</p>
<p>Follow the RedHat (CentOS 7x &amp; RHEL 7) guide, the recommended size of a swap partition depending on the amount of RAM &amp; whether you want sufficient memory for your system.</p>
<pre><code>swap &lt;= 10% * total-size-hard-drives &amp;&amp; swap &lt;= 128GB (if hibernation is allowed)
</code></pre><table>
<thead>
<tr>
<th>Amount of RAM</th>
<th>Recommended swap space</th>
<th>Recommended swap space if allowing for hibernation</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt; 2GB</td>
<td>2 * the-amount-of-RAM</td>
<td>3 * the-amount-of-RAM</td>
</tr>
<tr>
<td>&gt; 2GB - 8GB</td>
<td>the-amount-of-RAM</td>
<td>2 * the-amount-of-RAM</td>
</tr>
<tr>
<td>&gt; 8GB - 64GB</td>
<td>&gt;= 4GB</td>
<td>1.5 * the-amount-of-RAM</td>
</tr>
<tr>
<td>&gt; 64GB</td>
<td>&gt;= 4GB</td>
<td>Hibernation not recommended</td>
</tr>
</tbody>
</table>
<h2 id="3-common-misconceptions--gotchas">3. Common misconceptions &amp; gotchas</h2>
<h3 id="31-increasing-swap-size-would-increase-performance">3.1. Increasing swap size would increase performance</h3>
<ul>
<li>No, it wouldn&rsquo;t. Remember that the slowest part of memory is your hard-disk - <em>swap</em> just provides the ability to use more memory by swapping some pages out to the disk, which is <strong>slow</strong> compared to RAM operations. Swap can also <a href="https://askubuntu.com/questions/367881/does-swap-file-usage-increase-disk-i-o-and-cpu-load"target="_blank">increase disk I/O &amp; CPU load</a>. This is a tradeoff. Without swap, the OOM may get you. It causes a downtime and in the real life scenario, the application can be slow a bit rather than down completely.</li>
</ul>
<h3 id="32-swappiness">3.2. Swappiness</h3>
<ul>
<li>
<p>The linux kernel tunable parameter <code>vm.swappiness</code> (/proc/sys/vm/swappiness) can be used to define how aggressively memory pages are swapped to disk.</p>
</li>
<li>
<p>The default value: <code>60</code>. The lower the value, the less swapping is used &amp; the more memory pages are kept in the physical memory.</p>
<pre><code>* 0: swap is disable.
* 1: minimum amount of swapping without disabling it entirely.
* 10: recommended value to improve performance when sufficient memory exists in a system
* 100: aggressive swapping
</code></pre></li>
<li>
<p>Useful commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Check the current value</span>
sysctl vm.swappiness
<span style="color:#75715e"># Adjust the value</span>
echo <span style="color:#ae81ff">10</span> &gt; /proc/sys/vm/swappiness
sysctl -w vm.swappiness<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
echo <span style="color:#e6db74">&#34;vm.swappiness = 10&#34;</span> &gt;&gt; /etc/sysctl.conf
</code></pre></div></li>
<li>
<p>On SSDs, swapping out anonymous pages and reclaiming file pages are essentially equivalent in terms of performance/latency. On older spinning disks, swap reads are slower due to random reads, so a lower vm.swappiness setting makes sense there.</p>
</li>
</ul>
<h3 id="33-using-swap-as-emergency-memory">3.3. Using swap as emergency memory</h3>
<ul>
<li>Swap is not generally about getting emergency memory, it&rsquo;s about making memory reclamation egalitarian and efficient. In fact, using it as &ldquo;emergency memory&rdquo; is generally actively harmful.</li>
</ul>
<h2 id="4-references">4. References</h2>
<ol>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-x86#sect-recommended-partitioning-scheme-x86"target="_blank">RedHad guideline</a></p>
</li>
<li>
<p><a href="https://chrisdown.name/2018/01/02/in-defence-of-swap.html"target="_blank">Chris Down&rsquo;s post</a></p>
</li>
<li>
<p><a href="https://linuxhint.com/understanding_vm_swappiness/"target="_blank">Linux Hint - Understanding vm.swappiness</a></p>
</li>
</ol>
</article><section class="article labels"><a class="tag" href=/blog/tags/linux/>linux</a><a class="tag" href=/blog/tags/tech/>tech</a></section><section class="article license">CC Lincense</section></div><section class="article navigation"><p><a class="link" href="/blog/posts/ansitheus/"><span class="li iconfont icon-article"></span>Ansitheus</a></p></section><section class="article discussion">
    <script src="https://utteranc.es/client.js" repo="ntk148v/blog" issue-term="pathname" theme="github-light"
        crossorigin="anonymous" async>
    </script>
</section></section><section id="footer"><div style="display:flex; flex-direction:row; flex-wrap:wrap; justify-content:space-between;">
<p style="flex-shrink: 0;">/home/kiennt</p>
<p><span>Powered by </span><a
    href="https://gohugo.io" target="_blank">Hugo</a><span> and the </span><a
    href="https://themes.gohugo.io/hugo-notepadium/" target="_blank">Notepadium</a></p>
</div>
</section><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/&#43;DiW/UqRcLbRjq" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l&#43;B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd&#43;qj&#43;o24G5ZU2zJz" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
            onload="renderMathInElement(document.body);"></script></body>

</html>