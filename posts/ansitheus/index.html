<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.80.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ansitheus = Ansible &#43; Prometheus 1. Prometheus overview #   NOTE: Checkout the Prometheus official documentation.
 Prometheus is an open-source systems monitoring &amp; alerting toolkit originally built at SoundCloud.
1.1. Features #   a multi-dimensional data model with time series data identified by metric name &amp; key/value pairs PromQL, a flexible query language to leverage this dimensionality no reliance on distributed storage; single server nodes are autonomous time series collection happens via a pull model over HTTP pushing time series is supported via an intermediary gateway targets are discovered via service discovery or static configuration multiple modes of graphing &amp; dashboarding support  1.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Ansitheus" />
<meta property="og:description" content="Ansitheus = Ansible &#43; Prometheus 1. Prometheus overview #   NOTE: Checkout the Prometheus official documentation.
 Prometheus is an open-source systems monitoring &amp; alerting toolkit originally built at SoundCloud.
1.1. Features #   a multi-dimensional data model with time series data identified by metric name &amp; key/value pairs PromQL, a flexible query language to leverage this dimensionality no reliance on distributed storage; single server nodes are autonomous time series collection happens via a pull model over HTTP pushing time series is supported via an intermediary gateway targets are discovered via service discovery or static configuration multiple modes of graphing &amp; dashboarding support  1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ntk148v.github.io/blog/posts/ansitheus/" />
<meta property="article:published_time" content="2020-05-05T13:51:59+07:00" />
<meta property="article:modified_time" content="2020-05-05T13:51:59+07:00" /><meta property="og:site_name" content="/home/kiennt" />
<title>Ansitheus | /home/kiennt</title>
<link rel="manifest" href="/blog/manifest.json">
<link rel="icon" href="/blog/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/blog/book.min.5ca2df5b20a7e4a8337b9d188be38d0ada50d667cf0965aa47b5dc5064923270.css" integrity="sha256-XKLfWyCn5Kgze50Yi&#43;ONCtpQ1mfPCWWqR7XcUGSSMnA=">
<script defer src="/blog/en.search.min.a079338db8fd48f238863eeba3deae1ffbc297059015eb8f2bd3948b1e0fd07f.js" integrity="sha256-oHkzjbj9SPI4hj7ro96uH/vClwWQFeuPK9OUix4P0H8="></script>

<script defer src="/blog/sw.min.be1e3b3f88e332c359acd5e967344f6f6c1d04e690ab8dda0c12abe7c950a1d2.js" integrity="sha256-vh47P4jjMsNZrNXpZzRPb2wdBOaQq43aDBKr58lQodI="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/blog"><span>/home/kiennt</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li><a href="/blog/authors/kiennt/">About</a></li>
<li><a href="/blog/posts/">Blog</a></li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/blog/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Ansitheus</strong>

  <label for="toc-control">
    
    <img src="/blog/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-prometheus-overview">1. Prometheus overview</a>
      <ul>
        <li><a href="#11-features">1.1. Features</a></li>
        <li><a href="#12-architecture--components">1.2. Architecture &amp; components</a></li>
      </ul>
    </li>
    <li><a href="#2-ansitheus">2. Ansitheus</a>
      <ul>
        <li><a href="#21-why-ansitheus">2.1. Why Ansitheus?</a></li>
        <li><a href="#22-features">2.2. Features</a></li>
        <li><a href="#23-components">2.3. Components</a></li>
        <li><a href="#24-getting-started">2.4. Getting started</a></li>
        <li><a href="#25-contributors">2.5. Contributors</a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/blog/posts/ansitheus/">Ansitheus</a>
  </h1>
  
  <h5>May 5, 2020</h5>



  

  
  <div>
    
      <a href="/blog/tags/tech/">tech</a>, 
      <a href="/blog/tags/ansible/">ansible</a>, 
      <a href="/blog/tags/prometheus/">prometheus</a>
  </div>
  


  <p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Ansitheus <span style="color:#f92672">=</span> Ansible + Prometheus
</code></pre></div><h2 id="1-prometheus-overview">
  1. Prometheus overview
  <a class="anchor" href="#1-prometheus-overview">#</a>
</h2>
<blockquote>
<p><strong>NOTE</strong>: Checkout the <a href="https://prometheus.io/docs/introduction/overview/">Prometheus official documentation</a>.</p>
</blockquote>
<p><a href="https://github.com/prometheus">Prometheus</a> is an open-source systems monitoring &amp; alerting toolkit originally built at SoundCloud.</p>
<h3 id="11-features">
  1.1. Features
  <a class="anchor" href="#11-features">#</a>
</h3>
<ul>
<li>a multi-dimensional data model with time series data identified by metric name &amp; key/value pairs</li>
<li>PromQL, a flexible query language to leverage this dimensionality</li>
<li>no reliance on distributed storage; single server nodes are autonomous</li>
<li>time series collection happens via a pull model over HTTP</li>
<li>pushing time series is supported via an intermediary gateway</li>
<li>targets are discovered via service discovery or static configuration</li>
<li>multiple modes of graphing &amp; dashboarding support</li>
</ul>
<h3 id="12-architecture--components">
  1.2. Architecture &amp; components
  <a class="anchor" href="#12-architecture--components">#</a>
</h3>
<p>Prometheus scrapes metrics from instrumented jobs, either directly or via an intermediary push gateway for short-lived jobs. It stores all scraped samples locally &amp; runs rules over this data to either aggregate &amp; record new time series from existing data or generate alerts. Grafana or other API consumers can be used to visualize the collected data.</p>
<p><img src="https://prometheus.io/assets/architecture.png" alt="" /></p>
<ul>
<li>Prometheus server: scrapes &amp; stores time series data.</li>
<li>Prometheus alertmanager: handle alerts.</li>
<li>Special-purpose exporters.</li>
<li>Push-gateway: support short-lived jobs.</li>
<li>client libraries: instrument application code.</li>
<li>Various support tools: Grafana,&hellip;</li>
</ul>
<h2 id="2-ansitheus">
  2. Ansitheus
  <a class="anchor" href="#2-ansitheus">#</a>
</h2>
<h3 id="21-why-ansitheus">
  2.1. Why Ansitheus?
  <a class="anchor" href="#21-why-ansitheus">#</a>
</h3>
<p>As you can see that, Prometheus ecosystem consists of multiple components. The operator may need a lot of efforts to configure, deploy &amp; maintain these components. To make life easier, it is necessary to enter the world of automation, using modern tools of configuration management, provisioning &amp; orchestration. <a href="https://ansible.com">Ansible</a> is one of them. It is <a href="https://www.ansible.com/overview/how-ansible-works">simple, agentless IT automation that anyone can use</a>. My team decided to choose it as the automation solution, &amp; <a href="https://github.com/ntk148v/ansitheus">Ansitheus</a> is the result.</p>
<h3 id="22-features">
  2.2. Features
  <a class="anchor" href="#22-features">#</a>
</h3>
<p>The idea using Ansible to deploy Prometheus is not new. There are many existing solutions:</p>
<ul>
<li><a href="https://github.com/cloudalchemy/ansible-prometheus">cloudalchemy/ansible-prometheus</a></li>
<li><a href="https://github.com/ernestas-poskus/ansible-prometheus">ernestas-poskus/ansible-prometheus</a></li>
<li>&hellip;</li>
</ul>
<p>So what makes <code>Ansitheus</code> be different with others?</p>
<ul>
<li><strong>Deploy, configure &amp; maintain the Prometheus ecosystem easily</strong>.</li>
<li><strong>Allow users to configure, deploy the system from scratch</strong>:
<ul>
<li>Prepare, configure the local repository.</li>
<li>Install the necessary packages.</li>
<li>Configure Docker private registry.</li>
<li>Configure Docker daemon.</li>
</ul>
</li>
<li><strong>Containerize Prometheus components</strong>:
<ul>
<li><a href="https://docker.com">Docker</a> is hotter than hot because it makes it possible to get far more apps running on the same old servers &amp; it also makes it very easy to package &amp; ship programs.</li>
<li>You can easily find the advantages of Docker &amp; container through internet.</li>
</ul>
</li>
<li><strong>High availability</strong> with HAProxy &amp; Keepalived.</li>
<li><strong>Support centralized Docker logging</strong> with Fluentd.</li>
<li><strong>Support Ansible vault</strong> to work with sensitive data.</li>
</ul>
<h3 id="23-components">
  2.3. Components
  <a class="anchor" href="#23-components">#</a>
</h3>
<ul>
<li><a href="https://github.com/prometheus/prometheus">Prometheus Server</a></li>
<li><a href="https://github.com/prometheus/alertmanager">Prometheus Alertmanager</a></li>
<li><a href="https://github.com/prometheus/node_exporter">Prometheus Node-exporter</a></li>
<li><a href="https://github.com/google/cadvisor">Google Cadvisor</a></li>
<li><a href="https://github.com/prometheus/snmp_exporter">Prometheus SNMP exporter</a></li>
<li><a href="http://www.haproxy.org/">Haproxy</a></li>
<li><a href="https://www.keepalived.org/">Keepalived</a></li>
<li><a href="https://github.com/fluent/fluentd">Fluentd</a></li>
<li><a href="https://github.com/grafana/grafana">Grafana</a> - <strong>TODO</strong></li>
<li>Other Prometheus exporters - <strong>TODO</strong></li>
</ul>
<h3 id="24-getting-started">
  2.4. Getting started
  <a class="anchor" href="#24-getting-started">#</a>
</h3>
<ol>
<li>
<p>Install Ansible in deployment node.</p>
</li>
<li>
<p>Clone this repostiory.</p>
</li>
<li>
<p>Create configuration directory, default path <code>/etc/ansitheus</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mkdir -p /etc/ansitheus
sudo chown $USER:$USER /etc/ansitheus
</code></pre></div></li>
<li>
<p>Copy <code>config.yml</code> to <code>/etc/ansitheus</code> directory - this is the main configuration for Ansible monitoring tool.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp /path/to/ansitheus/repository/etc/ansitheus/config.yml <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    /etc/ansitheus/config.yml
</code></pre></div></li>
<li>
<p>Copy inventory files to the current directory.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp /path/to/ansitheus/repository/ansible/inventory/* .
</code></pre></div></li>
<li>
<p>Modify inventory &amp; <code>/etc/ansitheus/config.yml</code>.</p>
</li>
<li>
<p>Run <a href="./tools/ansitheus">tools/ansitheus</a>, figure out yourself:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Usage: ./tools/ansitheus COMMAND <span style="color:#f92672">[</span>option<span style="color:#f92672">]</span>

Options:
    --inventory, -i &lt;inventory_path&gt; Specify path to ansible inventory file
    --configdir, -c &lt;config_path&gt;    Specify path to directory with config.yml
    --verbose, -v                    Increase verbosity of ansible-playbook
    --tags, -t &lt;tags&gt;                Only run plays &amp; tasks tagged with these values
    --help, -h                       Show this usage information
    --skip-common                    Skip common role
    --ask-vault-pass                 Ask <span style="color:#66d9ef">for</span> vault password

Commands:
    precheck                         Do pre-deployment checks <span style="color:#66d9ef">for</span> hosts
    deploy                           Deploy &amp; start all ansitheus containers
    pull                             Pull all images <span style="color:#66d9ef">for</span> containers <span style="color:#f92672">(</span>only pull, no running containers<span style="color:#f92672">)</span>
    destroy                          Destroy Prometheus containers &amp; service configuration
                                        --include-images to also destroy Prometheus images
                                        --include-volumes to also destroy Prometheus volumes

</code></pre></div></li>
</ol>
<h3 id="25-contributors">
  2.5. Contributors
  <a class="anchor" href="#25-contributors">#</a>
</h3>
<ol>
<li><a href="https://github.com/ntk148v">Kien Nguyen</a></li>
<li><a href="https://github.com/vtdat">Dat Vu</a></li>
<li><a href="https://github.com/vanduc95">Duc Nguyen</a></li>
<li><a href="https://github.com/LongCaoBK">Long Cao</a></li>
</ol>
</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments"><section class="article discussion">
    <script src="https://utteranc.es/client.js" repo="ntk148v/blog" issue-term="pathname" theme="github-light"
        crossorigin="anonymous" async>
    </script>
</section></div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#1-prometheus-overview">1. Prometheus overview</a>
      <ul>
        <li><a href="#11-features">1.1. Features</a></li>
        <li><a href="#12-architecture--components">1.2. Architecture &amp; components</a></li>
      </ul>
    </li>
    <li><a href="#2-ansitheus">2. Ansitheus</a>
      <ul>
        <li><a href="#21-why-ansitheus">2.1. Why Ansitheus?</a></li>
        <li><a href="#22-features">2.2. Features</a></li>
        <li><a href="#23-components">2.3. Components</a></li>
        <li><a href="#24-getting-started">2.4. Getting started</a></li>
        <li><a href="#25-contributors">2.5. Contributors</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












