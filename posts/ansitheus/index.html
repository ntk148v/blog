<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="1Ansitheus = Ansible + Prometheus 1. Prometheus overview #   NOTE: Checkout the Prometheus official documentation.
 Prometheus is an open-source systems monitoring & alerting toolkit originally built at SoundCloud.
1.1. Features #   a multi-dimensional data model with time series data identified by metric name & key/value pairs PromQL, a flexible query language to leverage this dimensionality no reliance on distributed storage; single server nodes are autonomous time series collection happens via a pull model over HTTP pushing time series is supported via an intermediary gateway targets are discovered via service discovery or static configuration multiple modes of graphing & dashboarding support  1.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Ansitheus">
<meta property="og:description" content="1Ansitheus = Ansible + Prometheus 1. Prometheus overview #   NOTE: Checkout the Prometheus official documentation.
 Prometheus is an open-source systems monitoring & alerting toolkit originally built at SoundCloud.
1.1. Features #   a multi-dimensional data model with time series data identified by metric name & key/value pairs PromQL, a flexible query language to leverage this dimensionality no reliance on distributed storage; single server nodes are autonomous time series collection happens via a pull model over HTTP pushing time series is supported via an intermediary gateway targets are discovered via service discovery or static configuration multiple modes of graphing & dashboarding support  1.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ntk148v.github.io/blog/posts/ansitheus/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-05-05T13:51:59+07:00">
<meta property="article:modified_time" content="2021-02-02T14:58:49+07:00"><meta property="og:site_name" content="/home/kiennt">
<title>Ansitheus | /home/kiennt</title>
<link rel=manifest href=/blog/manifest.json>
<link rel=icon href=/blog/favicon.png type=image/x-icon>
<link rel=stylesheet href=/blog/book.min.2625e69c6b7661c7675edd24ba686fbc2f7d3dfe3fadbf62681b4d2cf2fead9d.css integrity="sha256-JiXmnGt2YcdnXt0kumhvvC99Pf4/rb9iaBtNLPL+rZ0=" crossorigin=anonymous>
<script defer src=/blog/flexsearch.min.js></script>
<script defer src=/blog/en.search.min.7dd3d330013b0c89a8aeb8eb53b13cbc277c6d1a551855ff874d4952baa089c8.js integrity="sha256-fdPTMAE7DImorrjrU7E8vCd8bRpVGFX/h01JUrqgicg=" crossorigin=anonymous></script>
<script defer src=/blog/sw.min.f4bc4151631c92d29816d24dfaacb947aa6b03f91ec1c0cd2738ba8957d04791.js integrity="sha256-9LxBUWMcktKYFtJN+qy5R6prA/kewcDNJzi6iVfQR5E=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css type=text/css>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/blog/><span>/home/kiennt</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li><a href=/blog/about/>About</a></li>
<li><a href=/blog/posts/>Posts</a></li>
<li><a href=https://ntk148v.github.io/notes>Notes</a></li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/blog/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Ansitheus</strong>
<label for=toc-control>
<img src=/blog/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#1-prometheus-overview>1. Prometheus overview</a>
<ul>
<li><a href=#11-features>1.1. Features</a></li>
<li><a href=#12-architecture--components>1.2. Architecture & components</a></li>
</ul>
</li>
<li><a href=#2-ansitheus>2. Ansitheus</a>
<ul>
<li><a href=#21-why-ansitheus>2.1. Why Ansitheus?</a></li>
<li><a href=#22-features>2.2. Features</a></li>
<li><a href=#23-components>2.3. Components</a></li>
<li><a href=#24-getting-started>2.4. Getting started</a></li>
<li><a href=#25-contributors>2.5. Contributors</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1>
<a href=/blog/posts/ansitheus/>Ansitheus</a>
</h1>
<h5>May 05, 2020</h5>
<div>
<a href=/blog/tags/tech/>#tech</a>
<a href=/blog/tags/ansible/>#ansible</a>
<a href=/blog/tags/prometheus/>#prometheus</a>
</div>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#111>Ansitheus</span> <span style=color:#f92672>=</span> Ansible + Prometheus
</code></pre></div><h2 id=1-prometheus-overview>
1. Prometheus overview
<a class=anchor href=#1-prometheus-overview>#</a>
</h2>
<blockquote>
<p><strong>NOTE</strong>: Checkout the <a href=https://prometheus.io/docs/introduction/overview/>Prometheus official documentation</a>.</p>
</blockquote>
<p><a href=https://github.com/prometheus>Prometheus</a> is an open-source systems monitoring & alerting toolkit originally built at SoundCloud.</p>
<h3 id=11-features>
1.1. Features
<a class=anchor href=#11-features>#</a>
</h3>
<ul>
<li>a multi-dimensional data model with time series data identified by metric name & key/value pairs</li>
<li>PromQL, a flexible query language to leverage this dimensionality</li>
<li>no reliance on distributed storage; single server nodes are autonomous</li>
<li>time series collection happens via a pull model over HTTP</li>
<li>pushing time series is supported via an intermediary gateway</li>
<li>targets are discovered via service discovery or static configuration</li>
<li>multiple modes of graphing & dashboarding support</li>
</ul>
<h3 id=12-architecture--components>
1.2. Architecture & components
<a class=anchor href=#12-architecture--components>#</a>
</h3>
<p>Prometheus scrapes metrics from instrumented jobs, either directly or via an intermediary push gateway for short-lived jobs. It stores all scraped samples locally & runs rules over this data to either aggregate & record new time series from existing data or generate alerts. Grafana or other API consumers can be used to visualize the collected data.</p>
<p><img src=https://prometheus.io/assets/architecture.png alt></p>
<ul>
<li>Prometheus server: scrapes & stores time series data.</li>
<li>Prometheus alertmanager: handle alerts.</li>
<li>Special-purpose exporters.</li>
<li>Push-gateway: support short-lived jobs.</li>
<li>client libraries: instrument application code.</li>
<li>Various support tools: Grafana,&mldr;</li>
</ul>
<h2 id=2-ansitheus>
2. Ansitheus
<a class=anchor href=#2-ansitheus>#</a>
</h2>
<h3 id=21-why-ansitheus>
2.1. Why Ansitheus?
<a class=anchor href=#21-why-ansitheus>#</a>
</h3>
<p>As you can see that, Prometheus ecosystem consists of multiple components. The operator may need a lot of efforts to configure, deploy & maintain these components. To make life easier, it is necessary to enter the world of automation, using modern tools of configuration management, provisioning & orchestration. <a href=https://ansible.com>Ansible</a> is one of them. It is <a href=https://www.ansible.com/overview/how-ansible-works>simple, agentless IT automation that anyone can use</a>. My team decided to choose it as the automation solution, & <a href=https://github.com/ntk148v/ansitheus>Ansitheus</a> is the result.</p>
<h3 id=22-features>
2.2. Features
<a class=anchor href=#22-features>#</a>
</h3>
<p>The idea using Ansible to deploy Prometheus is not new. There are many existing solutions:</p>
<ul>
<li><a href=https://github.com/cloudalchemy/ansible-prometheus>cloudalchemy/ansible-prometheus</a></li>
<li><a href=https://github.com/ernestas-poskus/ansible-prometheus>ernestas-poskus/ansible-prometheus</a></li>
<li>&mldr;</li>
</ul>
<p>So what makes <code>Ansitheus</code> be different with others?</p>
<ul>
<li><strong>Deploy, configure & maintain the Prometheus ecosystem easily</strong>.</li>
<li><strong>Allow users to configure, deploy the system from scratch</strong>:
<ul>
<li>Prepare, configure the local repository.</li>
<li>Install the necessary packages.</li>
<li>Configure Docker private registry.</li>
<li>Configure Docker daemon.</li>
</ul>
</li>
<li><strong>Containerize Prometheus components</strong>:
<ul>
<li><a href=https://docker.com>Docker</a> is hotter than hot because it makes it possible to get far more apps running on the same old servers & it also makes it very easy to package & ship programs.</li>
<li>You can easily find the advantages of Docker & container through internet.</li>
</ul>
</li>
<li><strong>High availability</strong> with HAProxy & Keepalived.</li>
<li><strong>Support centralized Docker logging</strong> with Fluentd.</li>
<li><strong>Support Ansible vault</strong> to work with sensitive data.</li>
</ul>
<h3 id=23-components>
2.3. Components
<a class=anchor href=#23-components>#</a>
</h3>
<ul>
<li><a href=https://github.com/prometheus/prometheus>Prometheus Server</a></li>
<li><a href=https://github.com/prometheus/alertmanager>Prometheus Alertmanager</a></li>
<li><a href=https://github.com/prometheus/node_exporter>Prometheus Node-exporter</a></li>
<li><a href=https://github.com/google/cadvisor>Google Cadvisor</a></li>
<li><a href=https://github.com/prometheus/snmp_exporter>Prometheus SNMP exporter</a></li>
<li><a href=http://www.haproxy.org/>Haproxy</a></li>
<li><a href=https://www.keepalived.org/>Keepalived</a></li>
<li><a href=https://github.com/fluent/fluentd>Fluentd</a></li>
<li><a href=https://github.com/grafana/grafana>Grafana</a></li>
<li>Other Prometheus exporters - <strong>TODO</strong></li>
</ul>
<h3 id=24-getting-started>
2.4. Getting started
<a class=anchor href=#24-getting-started>#</a>
</h3>
<ol>
<li>
<p>Install Ansible in deployment node.</p>
</li>
<li>
<p>Clone this repostiory.</p>
</li>
<li>
<p>Create configuration directory, default path <code>/etc/ansitheus</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>sudo mkdir -p /etc/ansitheus
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>sudo chown <span style=color:#111>$USER</span>:<span style=color:#111>$USER</span> /etc/ansitheus
</code></pre></div></li>
<li>
<p>Copy <code>config.yml</code> to <code>/etc/ansitheus</code> directory - this is the main configuration for Ansible monitoring tool.</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>cp /path/to/ansitheus/repository/etc/ansitheus/config.yml <span style=color:#8045ff>\
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span style=color:#8045ff></span>    /etc/ansitheus/config.yml
</code></pre></div></li>
<li>
<p>Copy inventory files to the current directory.</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>cp /path/to/ansitheus/repository/ansible/inventory/* .
</code></pre></div></li>
<li>
<p>Modify inventory & <code>/etc/ansitheus/config.yml</code>.</p>
</li>
<li>
<p>Run <a href=./tools/ansitheus>tools/ansitheus</a>, figure out yourself:</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>Usage: ./tools/ansitheus COMMAND <span style=color:#f92672>[</span>option<span style=color:#f92672>]</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>Options:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    --inventory, -i &lt;inventory_path&gt; Specify path to ansible inventory file
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>    --configdir, -c &lt;config_path&gt;    Specify path to directory with config.yml
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    --verbose, -v                    Increase verbosity of ansible-playbook
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    --tags, -t &lt;tags&gt;                Only run plays <span style=color:#111>&amp;</span> tasks tagged with these values
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>    --help, -h                       Show this usage information
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    --skip-common                    Skip common role
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    --ask-vault-pass                 Ask <span style=color:#00a8c8>for</span> vault password
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>Commands:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    precheck                         Do pre-deployment checks <span style=color:#00a8c8>for</span> hosts
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>    deploy                           Deploy <span style=color:#111>&amp;</span> start all ansitheus containers
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>    pull                             Pull all images <span style=color:#00a8c8>for</span> containers <span style=color:#f92672>(</span>only pull, no running containers<span style=color:#f92672>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>    destroy                          Destroy Prometheus containers <span style=color:#111>&amp;</span> service configuration
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>                                        --include-images to also destroy Prometheus images
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>                                        --include-volumes to also destroy Prometheus volumes
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>
</code></pre></div></li>
</ol>
<h3 id=25-contributors>
2.5. Contributors
<a class=anchor href=#25-contributors>#</a>
</h3>
<ol>
<li><a href=https://github.com/ntk148v>Kien Nguyen</a></li>
<li><a href=https://github.com/vtdat>Dat Vu</a></li>
<li><a href=https://github.com/vanduc95>Duc Nguyen</a></li>
<li><a href=https://github.com/LongCaoBK>Long Cao</a></li>
</ol>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/ntk148v/blog/commit/bdc638d0b7340a979e0f8edc8a713fd96a01c0d4 title="Last modified by Kien Nguyen | Feb 02, 2021" target=_blank rel=noopener>
<img src=/blog/svg/calendar.svg class=book-icon alt=Calendar>
<span>Feb 02, 2021</span>
</a>
</div>
<div>
<a class="flex align-center" href=https://github.com/ntk148v/blog/edit/master/content/posts/ansitheus.md target=_blank rel=noopener>
<img src=/blog/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments><section class="article discussion">
<script src=https://utteranc.es/client.js repo=ntk148v/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</section></div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#1-prometheus-overview>1. Prometheus overview</a>
<ul>
<li><a href=#11-features>1.1. Features</a></li>
<li><a href=#12-architecture--components>1.2. Architecture & components</a></li>
</ul>
</li>
<li><a href=#2-ansitheus>2. Ansitheus</a>
<ul>
<li><a href=#21-why-ansitheus>2.1. Why Ansitheus?</a></li>
<li><a href=#22-features>2.2. Features</a></li>
<li><a href=#23-components>2.3. Components</a></li>
<li><a href=#24-getting-started>2.4. Getting started</a></li>
<li><a href=#25-contributors>2.5. Contributors</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>